---
description: Firebase Realtime Database, Auth, Agora 등 외부 서비스 연동 패턴
globs: src/{config,services}/**/*.ts
alwaysApply: false
---

# 외부 서비스 연동

## Firebase 설정
- 초기화: `src/config/firebase.ts`에서 `initializeApp` → `db`, `auth` export
- 환경변수: `EXPO_PUBLIC_FIREBASE_*` 접두사 (6개)
- 인증: `signInAnonymously(auth)` — 별도 로그인 UI 없음

## Firebase Realtime Database 스키마
```
/queue/{uid}         { uid: string, joinedAt: number }
/matches/{matchId}   { user1: string, user2: string, channelName: string, createdAt: number }
```
- `channelName` 형식: `channel_{matchId}`
- 새 DB 경로 추가 시 이 규칙 파일에도 스키마 문서화

## Firebase 데이터 접근 패턴
```ts
import { ref, set, remove, onValue, off, get, push, runTransaction } from 'firebase/database';
import { db } from '../config/firebase';
```
- 쓰기: `set()` / `push()` / `remove()`
- 원자적 수정: `runTransaction()` (매칭처럼 동시성 이슈가 있는 경우)
- 리스너: `onValue()` + cleanup 시 `off()`

## Agora 설정
- App ID: `EXPO_PUBLIC_AGORA_APP_ID` 환경변수
- 토큰: MVP에서는 미사용 (빈 문자열 전달)
- 채널명은 Firebase match에서 생성된 `channelName` 사용
